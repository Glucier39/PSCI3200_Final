<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PSCI3200 Final Project – Home</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./PSCI3200 Final Project.html" aria-current="page"> 
<span class="menu-text">PSCI3200 Final Project</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">PSCI3200 Final Project</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<p>All of the data and scripts for this assignment can be found at https://github.com/Glucier39/PSCI3200_Final</p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Over the past two decades, China has rapidly emerged as a dominant financial actor in Africa, reshaping the development landscape of the continent’s most resource-rich states through infrastructure loans. Since 2000, “39 Chinese lenders provided 1,243 loans amounting to $170.08 billion to 49 African governments and seven regional institutions” (Boston University Global Development Policy Center, 2023). To meet China’s growing energy demand, a significant share of this financing has flowed to petrostates - countries whose economies are heavily dependent on the extraction and export of oil and natural gas (Sow, 2018).While there has been debate about the purpose of these loans, analysis have shown that they are critical for reducing trade costs with that country and increasing participation in global value chains (Amendolagine et al., 2024). Well established, is the fact that these loans are targeted towards resource cursed nations.</p>
<p>Africa’s resource-rich nations frequently encounter a paradox: despite their natural resource endowments, they fail to achieve sustained economic progress. Known as the resource curse or the “paradox of plenty”, these “countries with large endowments of natural resources, such as oil and gas, often perform worse in terms of economic development and governance than do countries with fewer resources” (Soros, 2007). Fundamentally, scholars note how the economic potential of resource wealth distorts governance incentives, enabling ruling elites to consolidate power, evade public accountability, and suppress institutional checks (National Resource Governance Institute, 2015). When government spending depends more on citizen taxation, those governments are more likely to democratize or circulate democratic values. Conversely, when governments rely heavily on resource rents to fund the national budget, public oversight tends to diminish and allows elites greater freedom to divert funds for personal gain (National Resource Governance Institute, 2015). Consequently, less money is reinvested into infrastructure and the country is forced to take out loans.</p>
<p>These loans have taken the “form of “loan-for-oil” agreements in which Chinese state development banks lend billions of dollars to oil-producing countries at below-market interest rates in exchange for the producers’ agreements to sell oil to Chinese oil companies (at future market prices rather than at a fixed price)” (Gholz, 2017). Moreover, while these loans do not always directly fund resource extraction, they are collateralized by future resource revenues (Usman, 2001). This financing model raises important questions about its implications for governance: oil-rich nations not only reflect the structural conditions associated with the resource curse (weak governance, rent seeking), but increasingly depend on opaque, collateralized lending arrangements that lack the transparency and accountability mechanisms commonly required by traditional lenders like the World Bank. Through these large, unconditional financial inflows, already corrupt governments can effectively bypass legislative oversight and public scrutiny.</p>
<p>Foundational work in resource curse literature, including studies by Ross (2001) and Auty (1993), demonstrates how resource-rich governments bypass the need for taxation and public accountability by leveraging resource revenues to entrench political power. At the local level, Isaksson and Kotsadam (2016) find that Chinese development projects are associated with increased local corruption in African countries. However, despite growing attention to China’s role as a lender, there remains a significant gap in the literature concerning the broader, country-level effects of Chinese loans on executive corruption across resource-rich states. Given the literature linking loans to corruption and the recent increase in Chinese loans to Africa, I wanted to see if there was a relationship between the two. Moreover, I think that understanding these loans reinforce corruption has important implications for development policy and environmental sustainability as a whole. <strong>This study aims to measure the impact of the Chinese loans country’s measure of executive corruption.</strong></p>
</section>
<section id="theory-and-hypotheses" class="level1">
<h1>Theory and Hypotheses</h1>
<section id="hypothesis-in-oil-rich-african-countries-higher-inflows-of-chinese-development-loans-in-a-given-year-cause-increases-in-executive-corruption" class="level3">
<h3 class="anchored" data-anchor-id="hypothesis-in-oil-rich-african-countries-higher-inflows-of-chinese-development-loans-in-a-given-year-cause-increases-in-executive-corruption">Hypothesis: In oil-rich African countries, higher inflows of Chinese development loans in a given year cause increases in executive corruption</h3>
<p>This hypothesis aims to find a causal relationship between the amount of Chinese loans a country receives within a given year and that same country’s executive corruption score (as constructed by the Varieties of Democracy Institute).</p>
<p>This hypothesis is grounded in two well-established strands of political economy literature: the resource curse and the governance implications of unconditional foreign lending. As previously stated, resource curse theory posits that resource wealth weakens institutions by allowing elites to rely on rents instead of taxation. Moreover, the need for these loans to repair crumbling infrastructure (because the elites have redirected money to themselves and their party) supports the claim that reliance on rents tends to erode democratic governance and foster corruption. Chinese development loans should hypothetically amplify these dynamics. Unlike traditional lenders such as the IMF or World Bank, Chinese financing is typically opaque, collateralized by future oil revenues, and largely free of governance or transparency conditions. As opposed to taking a traditional lender’s loan, which would require strict oversight and institutional reform, corrupt governments would much rather choose an unconditional loan, even if it favors China in the long term.</p>
<p>Given these theoretical mechanisms, it is reasonable to expect that an increase in Chinese development financing in oil-rich African states will correlate with rising levels of executive corruption. These funds not only reinforce the resource curse by freeing elites from domestic accountability, but also enable corruption by operating outside the bounds of public financial management systems. Compared to other types of corruption within the V-Dem index (public sector, legislative corruption, judicial corruption), executive is the most theoretically relevant and empirically appropriate proxy for this study. Chinese development loans are typically negotiated and managed at the highest levels of government, often through executive channels such as ministries of finance, state-owned enterprises, or heads of state themselves. Rather than testing the impact of Chinese loans on judiciary, legislative, or public sector corruption (or the aggregate political corruption index combining all), executive corruption should see the most pronounced impact and relationship.</p>
<p>Still, it is important to recognize that any observed change in executive corruption linked to Chinese loans is likely to be modest. In resource-rich African countries, corruption and governance outcomes are shaped by a complex constellation of historical, political, and institutional factors - ranging from legacies of colonialism to the structure and ideology of ruling parties. Chinese development finance represents just one piece of a much larger puzzle. As countries deepen their reliance on natural resource revenues, many are already on a trajectory consistent with the resource curse in which corruption tends to rise incrementally over time. Therefore, it would be overly simplistic to frame Chinese loans as the primary driver of corruption. Instead, they should be understood as a contributing factor that may reinforce existing governance vulnerabilities within broader patterns of institutional decline.</p>
<p>While China has distributed development loans across a wide range of African countries, a stronger effect on corruption is expected in petrostates. According to Ross (2001), petroleum wealth is particularly harmful to institutional quality (undermining governance, rule of law, increasing corruption) due to the centralized, high-value, and capital-intensive nature of oil extraction. Unlike minerals such as diamonds or gold, which are often extracted through more decentralized and labor-intensive processes, oil requires massive upfront investments in infrastructure like pipelines, refineries, and export terminals. This makes oil-exporting states more dependent on large-scale financing and more likely to engage in opaque “loan-for-oil” deals with external lenders such as China. Simultaneously, Chinese infrastructure loans serve a much more strategic benefit in petrostates.</p>
</section>
</section>
<section id="data-and-research-design" class="level1">
<h1>Data and Research Design</h1>
<p>This study utilizes a fixed effects regression across all petrostates from 2000–2021, controlling for time-invariant, unobserved country characteristics like geography, colonial history, and legal systems that could bias the relationship between Chinese loans and V-Dem’s executive corruption index. The model also controls for GDP per capita (in constant 2015 USD), the percentage of exports in GDP (as a %), and trade volume with China (in USD).</p>
<p>The quantity of Chinese Loans to Africa is the main independent variable. The Chinese Loans to Africa (CLA) Database, maintained by Boston University’s Global Development Policy Center, tracks loan commitments (measured in number of commitments per year) from Chinese state-owned banks, government entities, and companies to African governments, SOEs, and regional institutions. Originally developed by the China Africa Research Initiative at Johns Hopkins University, the database documents 1,306 commitments totaling $182.28 billion across 49 countries and 7 regional bodies from 2000 to 2023. Data is compiled from official documents, contractor websites, fieldwork, interviews, and media reports. While it reflects commitments rather than disbursements and may not capture all loans due to opacity, it remains widely used to assess the scale and strategic focus of Chinese development finance. To construct the annual loan variable, I grouped the data by country-year and calculated the number of loan commitments.</p>
<p>Executive corruption is the dependent variable. <code>v2x_execorr</code> from V-Dem measures how often executive officials engage in corruption—bribery, kickbacks, embezzlement, or misuse of public resources. The index is a composite of executive bribery (<code>v2exbribe</code>) and executive embezzlement (<code>v2exembez</code>), scaled from 0 to 1, where higher values indicate more frequent and severe corruption.</p>
<p>GDP per capita (logged; original values in constant 2015 USD) and exports as a share of GDP (logged; original values in %) are included as controls. These come from the World Bank Open Data portal. GDP per capita accounts for economic development, as wealthier states may have different corruption dynamics. The export-to-GDP ratio controls for trade dependence, which can affect rent-seeking by elites. In high-export economies, elites may access unearned foreign revenue with limited accountability.</p>
<p>Bilateral trade data with China, measured in USD (total annual trade value per country-year), comes from the UN Comtrade database via Open Trade Statistics (OTS). It captures total annual imports and exports for African countries from 2000 to 2021. This controls for broader China-Africa economic engagement, ensuring loan effects aren’t conflated with general trade trends.</p>
<p>A key limitation of the initial model is reverse causality—higher corruption may lead to more Chinese loans. To address this, I conduct two regressions using two-year lags for both executive corruption and loan count. Two years provides enough time for corruption or loan allocation to affect governance while remaining close enough for causal relevance. One-year lags may reflect administrative noise, while longer lags risk including unrelated political changes. By testing whether loans predict future corruption and vice versa, this approach probes endogeneity and strengthens the causal credibility of the original hypothesis.</p>
<p>This model assumes a causal relationship between Chinese lending and executive corruption, conditional on the included controls. However, limitations remain. The analysis cannot fully eliminate the risk of omitted variable bias or measurement error, especially given the opacity of Chinese loan data and potential underreporting of corruption. Moreover, even having controlled for the largest confounders (and further proxies that could be associated), we still have to assume that no unobserved time-varying factors simultaneously influence both loan allocation and corruption levels. While the fixed effects model helps address time-invariant confounding, and economic and trade controls mitigate many observable risks, causal interpretation ultimately relies on the assumption that any remaining bias is negligible or random.</p>
<section id="interactive-summary-statistics-table-raw-statistics" class="level2">
<h2 class="anchored" data-anchor-id="interactive-summary-statistics-table-raw-statistics">Interactive Summary Statistics Table (Raw Statistics)</h2>
<iframe src="data/summary_table_oil.html" width="100%" height="600px" style="border: none;">
</iframe>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="fixed-effect-regressions-impact-of-chinese-loans-on-africa-vs-petrostates" class="level3">
<h3 class="anchored" data-anchor-id="fixed-effect-regressions-impact-of-chinese-loans-on-africa-vs-petrostates">Fixed Effect Regressions: Impact of Chinese Loans on Africa Vs Petrostates</h3>
<iframe src="data/main_models.html" width="100%" height="600px" style="border: none;">
</iframe>
<p>The regression table supports the hypothesis that increased Chinese lending is associated with greater corruption, with statistically significant coefficients in both models. Substantively, for every one additional Chinese loan a country receives in a given year, its executive corruption index score increases by 0.0024 in the full African sample and 0.0038 among petrostates. While the absolute difference between these effects (0.0014) may appear small, it becomes more meaningful when viewed in the context of the V-Dem corruption index’s scale. Across all observations, the executive corruption index ranges from 0.485 to 0.985—a span of just 0.5. This means a change of 0.0038 represents roughly 0.76% of the total observed range. In countries receiving high loan volumes, the cumulative effect could reach a noticeable fraction of the corruption index. As stated previously, this small effect size was entirely to be expected. The stronger relationship observed in petrostates supports theories that resource-rich regimes may be especially susceptible to external financing mechanisms that enable elite capture or reduce domestic accountability. In the African sample, GDP per capita is positively and significantly associated with executive corruption, suggesting that as countries grow wealthier, political elites may gain greater access to rents without proportional increases in oversight. In contrast, trade with China shows no significant relationship. However, among petrostates, the pattern differs: GDP per capita is not significant, while trade with China becomes a strong and negative predictor of corruption. Here, GDP per capita may have little impact on executive corruption because oil revenues often concentrate wealth among elites without strengthening public accountability. As a result, economic growth does not necessarily curb rent-seeking, reflecting a classic resource curse dynamic.</p>
</section>
<section id="scatterplots-executive-corruption-vs-chinese-lending-20002021" class="level2">
<h2 class="anchored" data-anchor-id="scatterplots-executive-corruption-vs-chinese-lending-20002021">Scatterplots: Executive Corruption vs Chinese Lending (2000–2021)</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data/combined_execorr_plot.png" class="img-fluid figure-img"></p>
<figcaption>Executive corruption plotted against Chinese loans in petrostates and all African countries.</figcaption>
</figure>
</div>
<p>The scatterplots display that most country-year observations cluster around low Chinese loan counts (especially between 0–10), with very few receiving over 40 loans in a single year. Between both graphs, however, the relationships are skewed heavily by outliers. In this case, Angola received 80+ loans in 2016, disproportionately influencing the regression line and inflating the apparent relationship between loan volume and corruption. Moreover, the effect size should be interpreted with caution, as it may not reflect the experience of the typical African country.</p>
<p>While the models show a relationship between Chinese Loans and corruption, the relationship cannot be defined yet as causal: reverse causality remains a concern. It is still possible that, rather than Chinese loans driving executive corruption, corrupt countries are more likely to receive loans because they are excluded from other funding sources or because Chinese lenders face fewer political conditionalities. To address this, I performed lagged regressions in my empirical extension to establish directional causality.</p>
</section>
</section>
<section id="emperical-extension" class="level1">
<h1>Emperical Extension</h1>
<p>A lagged regression serves as a valuable empirical extension because it introduces temporal ordering to help address concerns about reverse causality. Here, the core question is whether increased Chinese lending causes higher levels of executive corruption, or whether more corrupt regimes receive more Chinese loans. To investigate this, I created two staggered variables to represent executive corruption and loan count two years ahead. I then ran two regressions: one testing whether current loan volumes predict corruption levels two years later, and another testing whether current corruption predicts loan volumes two years later.</p>
<section id="chinese-loans---executive-corruption-in-2-years" class="level3">
<h3 class="anchored" data-anchor-id="chinese-loans---executive-corruption-in-2-years">Chinese Loans -&gt; Executive Corruption in 2 Years</h3>
<p><span class="math display">\[\begin{equation}
\text{ExecCorr}_{it} = \beta_1 \cdot \text{Loans}_{it} + \beta_2 \cdot \text{GDP}_{it} + \beta_3 \cdot \text{Exports}_{it} + \beta_4 \cdot \text{Trade}_{it} + \alpha_i + \gamma_t + \epsilon_{it}
\end{equation}\]</span></p>
</section>
<section id="executive-corruption---chinese-loans-in-2-years" class="level3">
<h3 class="anchored" data-anchor-id="executive-corruption---chinese-loans-in-2-years">Executive Corruption -&gt; Chinese Loans in 2 Years</h3>
<p><span class="math display">\[\begin{equation}
\text{Loans}_{it} = \beta_1 \cdot \text{ExecCorr}_{it} + \beta_2 \cdot \text{GDP}_{it} + \beta_3 \cdot \text{Exports}_{it} + \beta_4 \cdot \text{Trade}_{it} + \alpha_i + \gamma_t + \epsilon_{it}
\end{equation}\]</span></p>
<section id="notation" class="level4">
<h4 class="anchored" data-anchor-id="notation">Notation</h4>
<ul>
<li><span class="math inline">\(i\)</span>: Country<br>
</li>
<li><span class="math inline">\(t\)</span>: Year<br>
</li>
<li><span class="math inline">\(\alpha_i\)</span>: Country fixed effects (e.g., geography, institutions)<br>
</li>
<li><span class="math inline">\(\gamma_t\)</span>: Year fixed effects (e.g., global or regional shocks)<br>
</li>
<li><span class="math inline">\(\epsilon_{it}\)</span>: Error term</li>
</ul>
<p>If previous loan levels significantly predict future corruption, this suggests that loans may be shaping governance outcomes over time. Conversely, we can also test the reverse by lagging the dependent variable—executive corruption—to see whether past corruption levels predict future loan volumes. If this relationship is weak or insignificant while the first is strong, it strengthens the case for a causal effect running from loans to corruption. This strategy helps rule out simultaneity, where both variables move together for unrelated reasons, and provides a clearer test of directionality, enhancing the credibility of the original hypothesis.</p>
<iframe src="data/lagged_models.html" width="100%" height="600px" style="border: none;">
</iframe>
</section>
</section>
<section id="regression-results" class="level2">
<h2 class="anchored" data-anchor-id="regression-results">Regression Results</h2>
<div>

</div>
<div class="columns quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="column quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<section id="table-1-loans-to-corruption-regression" class="level3">
<h3 class="anchored" data-anchor-id="table-1-loans-to-corruption-regression">Table 1: Loans to Corruption Regression</h3>
<iframe src="data/lag_oil_model.html" width="100%" height="400px" style="border: none;">
</iframe>
</section>
</div>
<div class="column quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<section id="table-2-corruption-to-loans-regression" class="level3">
<h3 class="anchored" data-anchor-id="table-2-corruption-to-loans-regression">Table 2: Corruption to Loans Regression</h3>
<iframe src="data/lag_inverse_model.html" width="100%" height="400px" style="border: none;">
</iframe>
</section>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>